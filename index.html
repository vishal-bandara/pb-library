<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PEOPLES BANK LIBRARY</title>

<!-- Firebase SDK (compat) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
/* ---------------- Body & Typography ---------------- */
body { 
  font-family: Arial, sans-serif; 
  background: #1b1b1b; 
  color: #333; 
  margin:0; 
  padding:0;
  position: relative;
  overflow-x: hidden;
}

/* Liquid / gradient animated background */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at 0% 0%, #ffeb3b55, transparent 60%),
              radial-gradient(circle at 100% 0%, #ff572255, transparent 65%),
              radial-gradient(circle at 0% 100%, #ff174455, transparent 65%),
              radial-gradient(circle at 100% 100%, #ffc10755, transparent 60%);
  mix-blend-mode: screen;
  z-index: -2;
  animation: liquidMove 18s infinite alternate ease-in-out;
}

@keyframes liquidMove {
  0% {
    transform: translate3d(0,0,0) scale(1);
  }
  50% {
    transform: translate3d(-10px,10px,0) scale(1.05);
  }
  100% {
    transform: translate3d(10px,-10px,0) scale(1.02);
  }
}

/* Soft overlay to keep content readable */
body::after {
  content:"";
  position: fixed;
  inset:0;
  background: linear-gradient(180deg, rgba(0,0,0,0.5), rgba(0,0,0,0.8));
  z-index:-1;
}

h1, h2, h3 {
  margin: 10px 0;
  color:#fff;
}

h2 { 
  color:#ffeb3b; 
  margin-top:30px; 
  text-align:center; 
  text-shadow: 0 0 6px rgba(0,0,0,0.8);
}

/* ---------------- Header & Navigation ---------------- */
header { 
  background: linear-gradient(90deg, #b71c1c, #e53935, #ffb300); 
  color:white; 
  padding: 15px 20px; 
  display:flex; 
  justify-content:space-between; 
  align-items:center; 
  flex-wrap: wrap;
  box-shadow:0 4px 10px rgba(0,0,0,0.4);
  position: sticky;
  top:0;
  z-index:20;
}

.logo-title {
  display:flex;
  flex-direction:column;
}

.logo-title h1 { 
  margin:0; 
  font-size: 1.8rem;
  letter-spacing: 2px;
  text-transform: uppercase;
}

.tagline {
  margin:0;
  font-size:0.9rem;
  color:#fffde7;
  text-transform:uppercase;
}

/* Christmas sparkle on title */
.logo-title h1 {
  text-shadow: 0 0 8px rgba(255,255,255,0.7),
               0 0 15px rgba(255,235,59,0.8);
}

/* Nav */
nav {
  display:flex;
  align-items:center;
  gap:10px;
}

nav a { 
  color:white; 
  margin:0 5px; 
  text-decoration:none; 
  font-weight:bold; 
  padding:6px 10px;
  border-radius:20px;
  background: rgba(0,0,0,0.2);
  border:1px solid rgba(255,255,255,0.5);
  transition: background 0.3s, transform 0.2s;
  font-size:0.95rem;
}

nav a:hover { 
  background: rgba(255,235,59,0.9);
  color:#b71c1c;
  transform: translateY(-2px);
}

/* Hamburger button */
.hamburger {
  display:none;
  font-size: 1.5rem;
  background: transparent;
  border:none;
  color:#fffde7;
  cursor:pointer;
}

/* ---------------- Book Grid ---------------- */
.book-grid { 
  display: grid; 
  grid-template-columns: repeat(auto-fill,minmax(150px,1fr)); 
  gap:15px; 
  padding:20px; 
}

.book-grid div { 
  background:rgba(255,255,255,0.1); 
  padding:10px; 
  border-radius:15px; 
  box-shadow:0 4px 10px rgba(0,0,0,0.6); 
  text-align:center; 
  transition: transform 0.3s, box-shadow 0.3s, background 0.3s; 
  border:1px solid rgba(255,235,59,0.5);
  backdrop-filter: blur(6px);
}

.book-grid div:hover { 
  transform: translateY(-6px); 
  box-shadow:0 8px 18px rgba(0,0,0,0.9);
  background:rgba(255,255,255,0.18);
}

.book-grid img { 
  width: 100%; 
  height: auto; 
  border-radius:8px; 
}

/* ---------------- Buttons ---------------- */
button { 
  padding:8px 12px; 
  border:none; 
  background:#ffb300; 
  color:#b71c1c; 
  border-radius:20px; 
  cursor:pointer; 
  transition: background 0.3s, transform 0.2s; 
  font-size: 1rem;
  margin-top: 8px;
  font-weight:bold;
}

button:hover { 
  background:#ffeb3b; 
  transform: translateY(-2px);
}

/* Disabled button style */
button:disabled {
  background:#bdbdbd;
  color:#424242;
  cursor:not-allowed;
}

/* ---------------- Table ---------------- */
table { 
  width:100%; 
  border-collapse:collapse; 
  margin-top:10px; 
  background:rgba(0,0,0,0.4);
  color:#fff;
  border-radius:10px;
  overflow:hidden;
}

th, td { 
  border:1px solid rgba(255,255,255,0.15); 
  padding:8px; 
  text-align:left; 
}

th { 
  background:#b71c1c; 
  color:white; 
}

#reservation-table {
  display: block;
  overflow-x: auto;
  white-space: nowrap;
}

/* ---------------- Sections ---------------- */
section { 
  padding:20px; 
  color:#f5f5f5;
}

ul { 
  list-style-type: disc; 
  padding-left: 20px; 
}

/* Christmas bullets */
section#rules ul li::marker,
section#notice ul li::marker {
  color:#ffeb3b;
}

/* ---------------- Responsive Design ---------------- */
@media screen and (max-width: 1024px) {
  header { 
    flex-wrap:nowrap; 
  }

  .hamburger {
    display:block;
  }

  nav {
    flex-direction: column;
    position:absolute;
    top:60px;
    right:10px;
    background:rgba(0,0,0,0.9);
    padding:10px;
    border-radius:10px;
    display:none;
    box-shadow:0 4px 10px rgba(0,0,0,0.8);
  }

  nav.show {
    display:flex;
  }
}

@media screen and (max-width: 768px) {
  .logo-title h1 { font-size: 1.4rem; }
  h2 { font-size: 1.3rem; }
  button { padding:6px 10px; font-size:0.95rem; }
}

@media screen and (max-width: 480px) {
  .logo-title h1 { font-size: 1.1rem; }
  h2 { font-size: 1.1rem; }
  button { padding:5px 8px; font-size:0.9rem; }
  .book-grid { grid-template-columns: repeat(auto-fill,minmax(120px,1fr)); gap:10px; padding:10px; }
}

/* ---------------- Extra Styles for Friendly Look ---------------- */
section#rules ul li,
section#notice ul li {
  margin-bottom:5px;
  font-size: 0.95rem;
}

section#contact p {
  margin:5px 0;
}

/* Simple falling snow effect using pseudo elements */
body {
  background-color:#000;
}

body::before,
body::after {
  pointer-events:none;
}

body::after {
  background-image:
    radial-gradient(2px 2px at 20% 20%, #ffffffaa 50%, transparent 51%),
    radial-gradient(2px 2px at 80% 30%, #ffffffaa 50%, transparent 51%),
    radial-gradient(2px 2px at 40% 80%, #ffffffaa 50%, transparent 51%),
    radial-gradient(3px 3px at 60% 10%, #ffffffaa 50%, transparent 51%),
    radial-gradient(3px 3px at 10% 60%, #ffffffaa 50%, transparent 51%);
  background-size: 300px 300px;
  animation: snowFall 20s linear infinite;
}

@keyframes snowFall {
  0% { transform: translateY(-50px); }
  100% { transform: translateY(50px); }
}
</style>
</head>
<body>

<header>
  <div class="logo-title">
    <h1>PEOPLES BANK LIBRARY</h1>
    <p class="tagline">PB LIBRARY â€¢ Merry Christmas ðŸŽ„</p>
  </div>

  <!-- Hamburger Menu -->
  <button class="hamburger" onclick="toggleMenu()">
    â˜°
  </button>

  <nav id="main-nav">
    <a href="#home">Home</a>
    <a href="https://docs.google.com/forms/d/e/1FAIpQLScD4MBgjJi0P2nsQ5KNh3lIrhI6FE49zUB242vqYKGieG_2UA/viewform?usp=publish-editor" target="_blank">New Patron</a>
    <a href="#rules">Rules</a>
    <a href="#notice">Notice</a>
    <a href="#contact">Contact</a>
  </nav>
</header>

<section id="home">
  <h2>New Arrivals</h2>
  <div id="book-list" class="book-grid"></div>
</section>

<section id="rules">
  <h2>Library Rules & Regulations</h2>
  <ul>
    <li>Membership Procedure - 
      Application forms should be duly completed and signed for registration as a member of the library. Any change of address or transfers should be informed to the Manager - Documentation Unit immediately.
    </li>

    <li>Library Tickets -
      Members will be issued with two Borrowers Cards for books and three Borrowers cards for periodicals. Officers Grade I and above would be issued three additional Borrowers Cards.
    </li>

    <li>Lending of Books and Periodicals -
      Two Books could be borrowed for a period of one month. 
      No extensions will be allowed if the books are required by another Library member. Telephone extensions are not entertained.
      Three periodicals could be borrowed for a period of one month. The same rules and regulations apply as for books, for periodicals loaned to the members.
    </li>

    <li>Overdue Books and Periodicals -
      A fine of Rs. 10.00 per day up to 14 calendar days would be levied on overdue books. 
      Thereafter thirty days grace period would be given for the replacement of the book. Books not replaced during this thirty days grace 
      period would accrue severe penalties which would be a fine of the current value of the book plus 25% surcharge which would be debited from 
      the Member's salary according to the agreement signed by the Member at the time of Registration.
    </li>

    <li>Loss of Library Material / Library Tickets -
      Members are responsible for their library cards and library material borrowed on them.
      Any material borrowed on a lost card remains the responsibility of the member. 
      Loss of Library cards and library material should be informed immediately. 
      Replacement of a card is on a payment of a fee of Rs.50/- per ticket.
    </li>

    <li>Care of Library Material - 
      Members are requested to use the material available in the Library carefully. 
      They should not mark or scribble or damage the material in any way. It is the responsibility of members to check and inform
      the Library staff of any damage to Library material before borrowing it. Otherwise he/she bears the risk of being held responsible for
      any mutilation noticed when the material is returned. We wish to reiterate that Library Members should extend their 
      fullest co-operation in complying with these rules, which are designed to provide a valuable service to all our Members and in turn for the development of our Bank and its services.
    </li>
    <li>Handle books carefully</li>
    <li>No food in library</li>
  </ul>
</section>

<section id="notice">
  <h2>Notices</h2>
  <ul>
    <li>DECLARATION - 
      I being a registered member of the People's Bank Library, agree to abide by the rules and regulations of the Library and to be responsible for the material lent to me.
      I have read and understood the current rules and regulations dated 1st August 1997.
      If, at the end of the loan period stipulated in the above rules and regulations, 
      I have not returned any material loaned to me from the Library, I agree to replace the same within a period of 30 days.
      At the end of this period, if for any reason the materials cannot be replaced, I agree to my salary being debited by a sum of money equivalent to the current cost price of the material,
      plus a surcharge of 25% of the cost price.
    </li>
    <li>Library closes at 5 PM</li>
    <li>New arrivals updated monthly</li>
  </ul>
</section>

<section id="contact">
  <h2>Contact</h2>
  <p>Developer: Vishal Bandara</p>
  <a href="https://vishal-bandara.github.io/vishalbandara/" target="_blank">About Developer</a>

  <p>Library Manager: Menaka Hadunpathirana</p>
</section>

<section id="admin">
  <h2>Admin Login</h2>
  <button onclick="adminLogin()">Login</button>
  <div id="admin-panel" style="display:none;">
    <h3>Reservations</h3>
    <table id="reservation-table">
      <tr>
        <th>Book</th><th>Staff ID</th><th>Phone</th><th>Date</th>
      </tr>
    </table>
  </div>
</section>

<script>
// Hamburger toggle
function toggleMenu() {
  const nav = document.getElementById('main-nav');
  nav.classList.toggle('show');
}

// ---------------- Firebase config (compat version) ----------------
const firebaseConfig = {
  apiKey: "AIzaSyC8_9CMdG2MyS-P9XGYRtd1K_9kNaEQSyc",
  authDomain: "pb-library-1501a.firebaseapp.com",
  projectId: "pb-library-1501a",
  storageBucket: "pb-library-1501a.appspot.com",
  messagingSenderId:"351111194912",
  appId:"1:351111194912:web:a24d7385a22ac51e220f45"
};
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ---------------- Books array ----------------
const books = [];
for(let i=1;i<=20;i++){
  books.push({id:i, title:"Book "+i, image:"images/book"+i+".jpg"});
}

// Display books and check reservation
const bookList = document.getElementById("book-list");

books.forEach(async book => {
  const div = document.createElement("div");
  div.innerHTML = `
    <img src="${book.image}" alt="${book.title}">
    <h3>${book.title}</h3>
    <button id="btn-${book.id}">Reserve</button>
  `;
  bookList.appendChild(div);

  const btn = document.getElementById("btn-"+book.id);

  // Check if the book is already reserved in Firestore
  const snapshot = await db.collection("reservations").where("bookId","==",book.id).get();
  if(!snapshot.empty){
    btn.disabled = true;
    btn.textContent = "Already Reserved";
  }

  btn.addEventListener("click", async ()=>{
    const staffId = prompt("Enter your Staff ID:");
    if(!staffId) return;
    const phone = prompt("Enter your Phone Number:");
    if(!phone) return;

    // Double-check Firestore before adding
    const check = await db.collection("reservations").where("bookId","==",book.id).get();
    if(!check.empty){
      alert("This book is already reserved!");
      btn.disabled = true;
      btn.textContent = "Already Reserved";
      return;
    }

    await db.collection("reservations").add({
      bookId: book.id,
      title: book.title,
      staffId,
      phone,
      reservedAt: new Date()
    });

    alert("Book reserved successfully!");
    btn.disabled = true;
    btn.textContent = "Already Reserved";
  });
});

// ---------------- Admin Login ----------------
const ADMIN_USER = "admin";
const ADMIN_PASS = "1234";

function adminLogin(){
  const username = prompt("Enter admin username:");
  const password = prompt("Enter admin password:");
  if(username===ADMIN_USER && password===ADMIN_PASS){
    const panel = document.getElementById("admin-panel");
    panel.style.display="block";
    showReservations();
  } else {
    alert("Wrong credentials!");
  }
}

// Show reservations and allow admin to reset
async function showReservations(){
  const table = document.getElementById("reservation-table");
  table.innerHTML = `<tr>
    <th>Book</th><th>Staff ID</th><th>Phone</th><th>Date</th><th>Action</th>
  </tr>`;

  const snapshot = await db.collection("reservations").get();
  snapshot.forEach(doc=>{
    const data = doc.data();
    const tr = document.createElement("tr");
    const dateText = data.reservedAt.toDate ? data.reservedAt.toDate().toLocaleString() : "";
    tr.innerHTML = `
      <td>${data.title}</td>
      <td>${data.staffId}</td>
      <td>${data.phone}</td>
      <td>${dateText}</td>
      <td><button onclick="resetReservation('${doc.id}', ${data.bookId})">Reset</button></td>
    `;
    table.appendChild(tr);
  });
}

// Admin reset function
async function resetReservation(docId, bookId){
  if(confirm("Reset this book to available?")){
    await db.collection("reservations").doc(docId).delete();
    alert("Book is now available!");

    // Update button on page
    const btn = document.getElementById("btn-"+bookId);
    if(btn){
      btn.disabled = false;
      btn.textContent = "Reserve";
    }

    showReservations(); // Refresh table
  }
}
</script>

</body>
</html>
